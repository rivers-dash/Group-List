<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>Group List !</title>
        <style>
            #zone_chat strong {
                color: white;
                background-color: black;
                padding: 2px;
            }
        </style>
    </head>

    <body>
        <h1>Group List</h1>

        <form action="/" method="post" id="formulaire_chat">
            <input type="text" name="item" id="item" placeholder="Nouvelle tâche ..." size="50" autofocus />
            <input type="submit" id="envoi_item" value="Envoyer" />
        </form>

				<ul id="tasks">
				</ul>


        <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
        <script src="/socket.io/socket.io.js"></script>
        <script>

            // Connexion à socket.io
            var socket = io.connect('http://localhost:8080');

            // On demande le user, on l'envoie au serveur et on l'affiche dans le titre
            var user = prompt('Quel est votre pseudo ?');
            socket.emit('newUser', user);
            document.title = user + ' - ' + document.title;

						socket.on('list', function(list) {
                list.forEach(function(item) {
									refreshList(item.user, item.item)
								})
            })

            // Quand on reçoit un item, on l'insère dans la page
            socket.on('item', function(data) {
                refreshList(data.user, data.item)
            })

            // Lorsqu'on envoie le formulaire, on transmet le item et on l'affiche sur la page
            $('#formulaire_chat').submit(function () {
                var item = $('#item').val();
                socket.emit('item', item); // Transmet le item aux autres
                refreshList(user, item); // Affiche le item aussi sur notre page
                $('#item').val('').focus(); // Vide la zone de Chat et remet le focus dessus
                return false; // Permet de bloquer l'envoi "classique" du formulaire
            });

            // Ajoute un item dans la page
            function refreshList(user, item) {
                $('#tasks').prepend('<li> ❌ <strong>' + user + ' : </strong> ' + item + '</li>');
            }
        </script>
    </body>
</html>
